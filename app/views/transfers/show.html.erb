<% content_for :title, "トークン詳細 | Myapp" %>

<div class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 py-6">
  <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <h1 class="text-2xl font-bold">送受信履歴詳細</h1>
  </div>

  <!-- 本体カード（ワイヤーの枠組み） -->
  <div class="mb-4 rounded-2xl border border-gray-300 bg-white p-4 sm:p-6 shadow-sm">
    <%# 便利用の変数（最新の送信/受信レコード） %>
    <% latest_sent      = @token.transfers.where(status: :sent).order(created_at: :desc).first rescue nil %>
    <% latest_received  = @token.transfers.where(status: :received).order(created_at: :desc).first rescue nil %>

    <div class="grid grid-cols-12">
      <div class="col-span-3 border border-gray-300 bg-gray-50 p-4 text-sm font-medium">トークンID</div>
      <div class="col-span-3 border border-gray-300 p-4 text-base"><%= @transfer.token_id %></div>
      <div class="col-span-3 border border-gray-300 bg-gray-50 p-4 text-sm font-medium">受信日</div>
      <div class="col-span-3 border border-gray-300 p-4"><%= l @transfer.updated_at %></div>
      <div class="col-span-3 border border-gray-300 bg-gray-50 p-4 text-sm font-medium">送信者</div>
      <div class="col-span-3 border border-gray-300 p-4"><%= "#{@transfer.sender&.name} (ID: #{@transfer.sender&.id})" %></div>
      <div class="col-span-3 border border-gray-300 bg-gray-50 p-4 text-sm font-medium">受信者</div>
      <div class="col-span-3 border border-gray-300 p-4"><%= "#{@transfer.receiver&.name} (ID: #{@transfer.receiver&.id})" %></div>
    </div>
    <% if defined?(user_signed_in?) && user_signed_in? &&
        [@transfer.sender_id, @transfer.receiver_id].compact.include?(current_user.id) %>
      <div class="mt-3 grid grid-cols-12">
        <div class="col-span-3 border border-gray-300 bg-gray-50 p-4 text-sm font-medium">メッセージ内容</div>
        <div class="col-span-9 border border-gray-300 p-4"><%= @transfer.message %></div>
      </div>
    <% end %>
  </div>
  <!-- 戻るボタン（左寄せ） -->
  <div class="flex items-center gap-2">
    <%= link_to "戻る",
        (request.referer.presence || mypage_path),
        class: "rounded-lg border px-3 py-2 text-sm hover:bg-gray-50" %>
  </div>
</div>
